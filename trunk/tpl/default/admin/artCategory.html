<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Article Category</title>
	{design}
    <link href="../css/adminCommon.css" rel="stylesheet" type="text/css"/>
    <link href="../css/adminFun.css" rel="stylesheet" type="text/css"/>
    <script language="javascript" type="text/javascript" src="../../../JObj/JObj.js"></script>
	{/design}
    <link href="{const key="PATH_CONTENT_ROOT"}tpl/default/css/adminCommon.css" rel="stylesheet" type="text/css">
    <link href="{const key="PATH_CONTENT_ROOT"}tpl/default/css/adminFun.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="{const key="PATH_CONTENT_ROOT"}JObj/JObj.js"></script>
</head>

<body>
<div class="btnGrp_sliveGray">
    <div class="left"></div>
    <div class="body"><a href="javascript:showWin()">Goto Category...</a></div>
    <div class="separator"></div>
    <div class="body"><a href="javascript:addNew()">Add</a></div>
    <div class="separator"></div>
    <div class="body"><a href="{$action}?token={token->newTokenForSmarty form='refreshArtCat'}">Force Refresh</a></div>	
    <div class="separator"></div>
    <div class="body">Back</div>
    <div class="right"></div>
</div>
<div class="clearBoth">
    <form action="{$action}" method="post">
        <input type="hidden" name="token" value="{$token}" />
        <table border="0">
            <tr>
                <td>ID</td>
                <td>Category Name</td>
                <td>Parent Category Name</td>
                <td>Sub Category Num</td>
                <td>Artegory Num</td>
                <td>Delete</td>
            </tr>
			{section name=idx loop=$artCat}
			{assign var="idx_" value=$smarty.section.idx.index}
            <tr>
                <td>{$artCat[idx].id}<input type="hidden" name="id[{$idx_}]" value="{$artCat[idx].id}"/></td>
                <td><input type="text" name="name[{$idx_}]" value="{$artCat[idx].name}"/><input type="hidden" name="_name[{$idx_}]" value="{$artCat[idx].name}"/></td>
                <td>
                    <div class="btnGrp_sliveGray">
                        <div class="left"></div>
                        <div class="body">{$artCat[idx].namepath|default:"Top Level"}</div>
                        <div class="separator"></div>
                        <div class="body">Reset</div>
                        <div class="right"></div>
                    </div>
                    <input type="hidden" name="faId[{$idx_}]" value="{$artCat[idx].fa_id}"/>
                    <input type="hidden" name="_faId[{$idx_}]" value="{$artCat[idx].fa_id}"/>
                </td>
                <td>{$artCat[idx].sub_num}&nbsp;</td>
                <td>{$artCat[idx].art_num|default:0}&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            {/section}
            <tr id="newTr">
                <td>*</td>
                <td><input type="text" name="name[{$idx_}]" value=""/></td>
                <td colspan="4">
                    <div class="btnGrp_sliveGray">
                        <div class="left"></div>
                        <div class="body">Select Parent Category...</div>
                        <div class="separator"></div>
                        <div class="body">Clear</div>
                        <div class="right"></div>
                    </div>
                    <input type="hidden" name="faId[{$idx_}]" value=""/>
                </td>
            </tr>
        </table>
        <input type="submit" value="Submit"/>
		{if $msg ne ""}
		<div>{$msg}</div>
		{/if}
    </form>
</div>
<span id="artCatXML"><!--{$artCatXML}--></span>
<div id="showArtCatTree"></div>
<script> var idx = {$idx_};</script>
{literal}
<script>
    var addNew = function() {
        var tpl = JObj.$("newTr");
        var tr = tpl.cloneNode(true);
        tr.removeAttribute("id");
        tpl.parentNode.appendChild(tr);
        tr.innerHTML = (tr.innerHTML.replace(/\[(\d*)\]/g, "[" + ++idx + "]"));
    }

    JObj.plugin("JWin", false);
    JObj.plugin("JTree", false);

    var jwin = null;
	var jtree = null;
    var showWin = function(){
        if(jwin == null){
            jwin = JObj.Plugin.JWin.getInstance(500,300);
            jwin.setTitle("Usnower...");
            jwin.setSysButtons(false,true,true);
			jtree = JObj.Plugin.JTree.getInstance("showArtCatTree");
			jtree.loadFromString(  JObj.$("artCatXML").innerHTML.replace(/((<!--)|(-->))/g,"").trim() );
            jtree.CAPTIONATT = "name";
            jtree.create();
			jwin.setBody(JObj.$("showArtCatTree"));
            jwin.setDrag(true);
        }
        jwin.showModal();
    }
</script>
{/literal}
</body>
</html>
